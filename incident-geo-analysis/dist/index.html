<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Garland TX Police Incidents Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      #map {
        height: 100vh;
        width: 100vw;
      }
      .leaflet-tooltip-pane .leaflet-tooltip {
        background: transparent;
        border: none;
        box-shadow: none;
        color: black;
        font-weight: bold;
        text-shadow: 0 0 3px white, 0 0 3px white, 0 0 3px white, 0 0 3px white;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      // Initialize the map
      var map = L.map("map").setView([32.9126, -96.6389], 12); // Garland, TX
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "Â© OpenStreetMap",
      }).addTo(map);

      // Load GeoJSON data
      fetch("features.geojson")
        .then((response) => response.json())
        .then((data) => {
          const geoJsonLayer = L.geoJSON(data, {
            onEachFeature: function (feature, layer) {
              if (feature.properties) {
                // Permanent label with incident type
                if (feature.properties.incident) {
                  layer.bindTooltip(feature.properties.incident, {
                    permanent: true,
                    direction: "top",
                    className: "incident-label",
                  });
                }

                // Popup with all details on hover
                let popupContent = `<strong>Incident:</strong> ${feature.properties.incident}<br>`;
                popupContent += `<strong>Address:</strong> ${feature.properties.address}<br>`;
                popupContent += `<strong>Date:</strong> ${feature.properties.date}`;
                layer.bindPopup(popupContent);
              }
            },
          }).addTo(map);
          map.fitBounds(geoJsonLayer.getBounds());
        })
        .catch((err) => {
          console.error("Failed to load features.geojson:", err);
        });
    </script>
  </body>
</html>
